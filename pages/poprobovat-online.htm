title = "Попробовать online"
url = "/try"
layout = "main"
description = "Попробовать online"
meta_title = "Попробовать online"
meta_description = "Попробовать online"
is_hidden = 0

[viewBag]
localeUrl[en] = "/poprobovat-online"
==
<?php
function onStart()
{
    $this->addJs('assets/js/codemirror.js');
    $this->addJs('assets/js/simple.js');
	$this->addJs('assets/js/fusion.js');
    $this->addJs('assets/js/javascript.js');
    $this->addJs('https://cdn.polyfill.io/v2/polyfill.min.js');
}
?>
==
<script>

	//var server = 'http://localhost:8888';
	var server = 'https://tryonline.lsfusion.org';

	//var demoServer = 'http://localhost:8888';
	var demoServer = 'http://demo.lsfusion.org/erp';

	// var start_server = false,
	// 		serverStartReturn,
	// 		lastServerReturn,
	// 		countServerLog = -1,
	// 		startTime,
	// 		prevExampleServerResult;

	window.onbeforeunload = function() {
		if (window.start_server) {
			stopServer();
			window.start_server = false;
			window.clearInterval(window.timerIdIsActiveTab);
			//выключаем получение логов
			window.clearInterval(window.getLogServerScheduler);
			return "Данные не сохранены. Точно перейти?";
		}
	};

	function isActiveTab() {
		// if (window.start_server) {
		// 	window.onbeforeunload = function() {
		// 		pullServerRequest('', 'stop');
		// 		return "Данные не сохранены. Точно перейти?";
		// 	};
		// }
		if (
			document.hidden &&
			window.start_server
		) {
			console.log('func isActiveTab');
			//pullServerRequest('', 'stop');
		}
	}

	//var timerIdIsActiveTab = setInterval(isActiveTab, 1000);

	//var timerIdGetLogServer;

	function pullServerRequestDBMSMode() {
		var activeTab = document.getElementById('tab_db');
		var resultArea = activeTab.querySelector('.plagin-panel__second-box');
		var code = activeTab.querySelector('.CodeMirror').CodeMirror.getValue();

		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;
		xhr.open("POST", demoServer + "/eval");
		xhr.setRequestHeader("Content-Type", "text/plain");
		xhr.send(code);

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				resultArea.value = this.responseText;
			}
		});

	}

	function startServer(code, resultArea) {
		console.log('func startServer');

		resultArea.value = '';
		window.lastServerReturn = 0;

		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", server + "/exec?action=Main.startServer");
		xhr.setRequestHeader("Content-Type", "text/json");

		let request = btoa(unescape(encodeURIComponent(JSON.stringify({'code': code}))));
		xhr.send(request);

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				window.serverStartReturn = JSON.parse(this.responseText).server;
				window.getLogServerScheduler = window.setInterval(function() {
					getLogServer(resultArea); //включаем получение логов
				}, 100);

				return this.responseText;
			}
		});
	}

	function stopServer() {
		console.log('func stopServer');
		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", server + "/exec?action=Main.stopServer");
		xhr.setRequestHeader("Content-Type", "text/json");

        let request = btoa(unescape(encodeURIComponent(JSON.stringify({'server': window.serverStartReturn}))));
		xhr.send(request);

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				return this.responseText;
			}
		});
	}

	function restartServer(code, resultArea) {
		console.log('func restartServer');
		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", server + "/exec?action=Main.restartServer");
		xhr.setRequestHeader("Content-Type", "text/json");

		let request = btoa(unescape(encodeURIComponent(JSON.stringify({'server': window.serverStartReturn, 'code': code}))));
		xhr.send(request);

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				resultArea.value = '';
				window.lastServerReturn = 0;
				return this.responseText;
			}
		});
	}

	function getLogServer(resultArea) {
		console.log('func getLogServer');

		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", server + "/exec?action=Main.getServerLog");
		xhr.setRequestHeader("Content-Type", "text/json");

		let request = btoa(unescape(encodeURIComponent(JSON.stringify({'server': window.serverStartReturn, 'lastAnswer': window.lastServerReturn}))));
		xhr.send(JSON.stringify(request));

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				let oldTextareaValue = resultArea.value;
				let response = JSON.parse(this.responseText);
				if(response != null && response.text != null) {
					resultArea.value = oldTextareaValue + response.text;
					resultArea.scrollTop = resultArea.scrollHeight;
					window.lastServerReturn = response.answer;
				} else if (oldTextareaValue === '') {
					resultArea.value = 'Server is starting...\n';
				}
			}
		});
	}

	function pullServerRequest(_this) {
		console.log('func pullServerRequest');

		let activeTab = document.querySelector('.mode-content.active');
		let resultArea = activeTab.querySelector('.plagin-panel__second-box');
		let code = activeTab.querySelector('.CodeMirror').CodeMirror.getValue();

		if (window.start_server) {
			if(window.lastServerReturn > 0) {
				restartServer(code, resultArea);
			}
		} else {
			window.start_server = true;
			window.timerIdIsActiveTab = setInterval(isActiveTab, 1000);
			startServer(code, resultArea);
			document.getElementById("startPlatformButton").style.display="none";
			document.getElementById("restartPlatformButton").style.display="block";
		}

		console.log('start_server = ' + window.start_server);

		// xxx
		// var data = "run() {EXPORT FROM name(DepartmentStore s);}";
		// var xhr = new XMLHttpRequest();
		// xhr.withCredentials = true;
		//
		// xhr.open("POST", "http://demo.lsfusion.org/erp/eval");
		// xhr.setRequestHeader("Content-Type", "text/plain");
		//
		// xhr.send(data);
		//
		// xhr.addEventListener("readystatechange", function () {
		// 	console.log(this);
		// });




		// var data = _this.parentNode.querySelector('textarea.active');
		//
		// var xhr = new XMLHttpRequest();
		// xhr.withCredentials = true;
		//
		// xhr.addEventListener("readystatechange", function () {
		// 	document.querySelector('textarea[data-id="text_1"]').text = this.responseText;
		// });
		//
		// xhr.open("GET", "http://demo.lsfusion.org/erp/eval");
		// xhr.setRequestHeader("cache-control", "no-cache");
		// xhr.setRequestHeader("Postman-Token", "21abf46f-99ea-44c5-ac70-1e800c1c6c84");
		//
		// xhr.send(data);
	}
</script>

<div class="show-devices">
	<p class="device-text">Доступно только в десктопной версии</p>
</div>
<div class="mode-panel hide-devices">
	<ul class="mode-panel__mode-list">
		<li class="mode-panel__mode-li">
			<a class="link mode-panel__mode-item mode-panel__mode-item_active" href="#tab_db">Режим СУБД</a>
		</li>
		<li class="mode-panel__mode-li">
			<a class="link mode-panel__mode-item" href="#tab_platform">Режим Платформа</a>
		</li>
	</ul>
</div>
<div class="mode-content hide-devices active" id="tab_db">
	<div class="plagin-panel hide-devices">
		<div class="plagin-panel__panel-item plagin-panel__left-item plagin-panel__panel-item_first-box">
			<div class="plagin-panel__plagin-box">
				<a class="btn btn_round" href="javascript:void(0);" onclick="pullServerRequestDBMSMode();">
					<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}">
				</a>
			</div>
		</div>
		<div class="plagin-panel__panel-item plagin-panel__right-item">
			<div class="plagin-panel__text-box text">
				Сервер приложений выполняется в виртуальной Java машине (JVM), что позволяет подключить к нему любую из многочисленных существующих Java-библиотек. Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и использовать, как если бы оно было встроенным или реализованным на языке платформы. Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.
			</div>
			<textarea readonly class="plagin-panel__second-box"></textarea>
		</div>
	</div>
</div>

<div class="mode-content hide-devices" id="tab_platform">
	<div class="plagin-panel hide-devices">
		<div class="plagin-panel__panel-item plagin-panel__left-item plagin-panel__panel-item_first-box">
			<div class="plagin-panel__plagin-box">
                <a class="btn btn_round" href="javascript:void(0);" id="startPlatformButton" onclick="pullServerRequest(this);">
                    <img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }} ">
                </a>
				<a class="btn btn_restart" href="javascript:void(0);" id="restartPlatformButton" style="display:none" onclick="pullServerRequest(this);">
					<img alt="arrow" src="{{ 'assets/images/arrow-restart.svg'|theme }}">
				</a>
			</div>
		</div>
		<div class="plagin-panel__panel-item plagin-panel__right-item">
			<div class="plagin-panel__text-box text">
				Сервер приложений выполняется в виртуальной Java машине (JVM), что позволяет подключить к нему любую из многочисленных существующих Java-библиотек. Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и использовать, как если бы оно было встроенным или реализованным на языке платформы. Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.
			</div>
			<textarea readonly class="plagin-panel__second-box"></textarea>
		</div>
	</div>
</div>

<script>
	window.onload = onLoad();

	function onLoad() {
		var textareas = document.querySelectorAll('.plagin-panel__second-box');
		for (i = 0; i < textareas.length; i++) {
			addResultTextareasListeners(textareas[i]);
		}

		loadExamples();
	}

	function addResultTextareasListeners(textarea) {
		textarea.addEventListener("mouseover", function(event) {
			textarea.style.overflow = 'auto';
		});
		textarea.addEventListener("mouseout", function(event) {
			textarea.style.overflow = 'hidden';
		});
	}

	function loadExamples() {
		var tabs = document.querySelectorAll('.mode-content');
		for (t = 0; t < tabs.length; t++) {
			var currentTab = tabs[t];

			var xhr = new XMLHttpRequest();
			xhr.withCredentials = true;

			xhr.open("POST", server + "/exec?action=Main.getExamples");
			xhr.setRequestHeader("Content-Type", "application/json");

			var data = '{mode: ' + t + '}';
			xhr.send(data);

			xhr.addEventListener("readystatechange", function(currentTab, tab) {return function() {
				if (
						this.readyState === 4
				) {
					try {
						var json = JSON.parse(this.responseText);
					} catch (e) {
						console.log(e);
					}
					var list = document.createElement("ul");
					list.classList.add("listfilter-panel__list");
					for (i in json) {
						var listItem = document.createElement("li");
						listItem.classList.add("listfilter-panel__item");
						var label = document.createElement("label");
						label.classList.add("listfilter");
						var listItemID = "input_" + tab + '_' + i;
						label.setAttribute("for", listItemID);
						label.setAttribute("data-value", json[i].text);

						var input = document.createElement("input");
						input.classList.add("listfilter__input");
						input.id = listItemID;
						input.type = "radio";
						// input.name = "text_" + i;
						input.name = "radioMode_" + tab;
						input.value = "text_" + i;
						if (i == 0) {
							input.setAttribute("checked", "checked");
						}
						label.appendChild(input);
						label.addEventListener('click', activate, !1);

						var span = document.createElement("span");
						span.classList.add("listfilter__caption");
						span.classList.add("caption");
						label.appendChild(span);

						span.innerText = json[i].caption;
						var checkdiv = document.createElement("div");
						checkdiv.classList.add("listfilter_check");
						label.appendChild(checkdiv);

						listItem.appendChild(label);
						list.appendChild(listItem);
					}
					var listFilterCurrent = document.createElement("div");
					listFilterCurrent.classList.add("listfilter-panel__current");
					listFilterCurrent.addEventListener('click', addClassActive, false);

					var captionDiv = document.createElement("div");
					captionDiv.classList.add("caption");
					if (json.length > 0) {
						captionDiv.innerText = json[0].caption;
					}
					listFilterCurrent.appendChild(captionDiv);

					var linkOffDiv = document.createElement("div");
					linkOffDiv.classList.add("link-off");
					listFilterCurrent.appendChild(linkOffDiv);

					var img = document.createElement("img");
					img.alt = "off";
					img.src = "{{ 'assets/images/arrow-white.svg'|theme }}";
					linkOffDiv.appendChild(img);

					var listFilter = document.createElement("div");
					listFilter.classList.add("listfilter-panel");
					listFilter.appendChild(listFilterCurrent);

					var listScroller = document.createElement("div");
					listScroller.classList.add("listfilter-scroller");
					listScroller.appendChild(list);
					listFilter.appendChild(listScroller);

					var textarea = document.createElement("textarea");
					textarea.classList.add('editor-panel', 'active');
					textarea.id = 'textarea_' + t;

					var plaginBox = currentTab.querySelector(".plagin-panel__plagin-box");
					var button = plaginBox.firstChild;
					plaginBox.insertBefore(listFilter, button);
					plaginBox.insertBefore(textarea, button);

					if (json.length > 0) {
						textarea.innerHTML = json[0].text;
						// textarea.innerText = json[0].text;
						var editor = textarea.nextSibling;
						if (editor) {
							editor.remove();
						}

						codeMirrorFromTextarea(currentTab, textarea);
					}
				}
			}}(currentTab, t))
		}
	}

	function codeMirrorFromTextarea(parent, textArea) {
		CodeMirror.fromTextArea(textArea, {
			mode: "fusion",
			theme: 'darcula',
			selectionPointer: true
		});

		parent.querySelector('.CodeMirror').addEventListener("mouseover", function(event) {
			parent.querySelector('.CodeMirror-hscrollbar').classList.add('CodeMirror-hscrollbar-auto');
			parent.querySelector('.CodeMirror-vscrollbar').classList.add('CodeMirror-vscrollbar-auto');
		});
		parent.querySelector('.CodeMirror').addEventListener("mouseout", function(event) {
			parent.querySelector('.CodeMirror-hscrollbar').classList.remove('CodeMirror-hscrollbar-auto');
			parent.querySelector('.CodeMirror-vscrollbar').classList.remove('CodeMirror-vscrollbar-auto');
		});
	}

	function addClassActive() {
		var menu = Helpers.parents(this, '.listfilter-panel')[0];
		if (menu.classList.contains('list-active')) {
			menu.classList.remove('list-active')
		} else {
			menu.classList.add('list-active')
		}
	}

	function activate(e) {
		var box = Helpers.parents(this, '.plagin-panel'),
				id = this.attributes.for.value,
				panels = box[0].querySelectorAll('.editor-panel'),
				val = e.currentTarget.dataset.value,
				name = this.querySelectorAll('.caption')[0].innerText;

		if (box[0].querySelectorAll('.CodeMirror')[0]) {
			var editor = panels[0].nextSibling;
			editor.remove();
		}
		panels[0].innerHTML = this.dataset.value;
		codeMirrorFromTextarea(box[0], panels[0]);

		for (var p = 0; p < panels.length; p++) {
			panels[p].classList.remove('active');
			if (panels[p].id == id) {
				panels[p].classList.add('active');
			}
		}
		Helpers.parents(this, '.listfilter-panel')[0].querySelectorAll('.listfilter-panel__current .caption')[0].innerText = name;
		Helpers.parents(this, '.listfilter-panel')[0].classList.remove('list-active');
	}
</script>

<!--<div class="show-devices">-->
	<!--<p class="device-text">Доступно только в десктопной версии</p>-->
<!--</div>-->
<!--<div class="mode-panel hide-devices">-->
	<!--<ul class="mode-panel__mode-list">-->
		<!--<li class="mode-panel__mode-li">-->
			<!--<a class="link mode-panel__mode-item mode-panel__mode-item_active" href="#tab_1">Режим СУБД</a>-->
		<!--</li>-->
		<!--<li class="mode-panel__mode-li">-->
			<!--<a class="link mode-panel__mode-item" href="#tab_2">Режим Платформа</a>-->
		<!--</li>-->
	<!--</ul>-->
<!--</div>-->

<!--<div class="mode-content hide-devices active" id="tab_1">-->
	<!--<div class="plagin-panel hide-devices">-->
		<!--<div class="plagin-panel__panel-item plagin-panel__panel-item_first-box">-->
			<!--<div class="plagin-panel__plagin-box">-->
				<!--<div class="listfilter-panel">-->
					<!--<div class="listfilter-panel__current">-->
						<!--<div class="caption">EXPORT FROM name</div>-->
						<!--<div class="link-off">-->
							<!--<img alt="off" src="{{ 'assets/images/arrow-white.svg'|theme }}">-->
						<!--</div>-->
					<!--</div>-->
					<!--<ul class="listfilter-panel__list">-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_1">-->
								<!--<input class="listfilter__input" id="text_1" type="radio" name="text_1" checked="checked"/>-->
								<!--<span class="listfilter__caption caption">EXPORT FROM name</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_2">-->
								<!--<input class="listfilter__input" id="text_2" type="radio" name="text_1"/>-->
								<!--<span class="listfilter__caption caption">Text 2</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_3">-->
								<!--<input class="listfilter__input" id="text_3" type="radio" name="text_1"/>-->
								<!--<span class="listfilter__caption caption">Text 3</span>-->
							<!--</label>-->
						<!--</li>-->
					<!--</ul>-->
				<!--</div>-->
<!--<textarea class="editor-panel active" id="text_1">run() {-->
	<!--EXPORT FROM name(DepartmentStore s);-->
<!--}</textarea>-->
                  <!--<textarea class="editor-panel" id="text_2">function HelloWorld() {-->
  <!--console.log('Hello world12');-->
<!--}</textarea>-->
<!--<textarea class="editor-panel" id="text_3">function HelloWorld() {-->
  <!--console.log('Hello world13');-->
<!--}</textarea>-->
				<!--<a class="btn btn_round" href="#" onclick="pullServerRequest(this);">-->
					<!--<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}" />-->
				<!--</a>-->
			<!--</div>-->
		<!--</div>-->

		<!--<div class="plagin-panel__panel-item">-->
			<!--<div class="plagin-panel__text-box text">-->
				<!--Сервер приложений выполняется в виртуальной Java машине (JVM),-->
				<!--что позволяет подключить к нему любую из многочисленных существующих Java-библиотек.-->
				<!--Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и-->
				<!--использовать, как если бы оно было встроенным или реализованным на языке платформы.-->
				<!--Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.-->
			<!--</div>-->
			<!--<textarea class="plagin-panel__second-box active" data-id="text_1"></textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_2"></textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_3"></textarea>-->
		<!--</div>-->
	<!--</div>-->
<!--</div>-->

<!--<div class="mode-content hide-devices" id="tab_2">-->
	<!--<div class="plagin-panel hide-devices">-->
		<!--<div class="plagin-panel__panel-item plagin-panel__panel-item_first-box">-->
			<!--<div class="plagin-panel__plagin-box">-->
				<!--<div class="listfilter-panel">-->
					<!--<div class="listfilter-panel__current">-->
						<!--<div class="caption">Hello world</div>-->
						<!--<div class="link-off">-->
							<!--<img alt="off" src="{{ 'assets/images/arrow-white.svg'|theme }}">-->
						<!--</div>-->
					<!--</div>-->
					<!--<ul class="listfilter-panel__list">-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_5">-->
								<!--<input class="listfilter__input" id="text_5" type="radio" name="text_5" checked="checked"/>-->
								<!--<span class="listfilter__caption caption">Hello world</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_6">-->
								<!--<input class="listfilter__input" id="text_6" type="radio" name="text_6"/>-->
								<!--<span class="listfilter__caption caption">Text 2</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_7">-->
								<!--<input class="listfilter__input" id="text_7" type="radio" name="text_7"/>-->
								<!--<span class="listfilter__caption caption">Text 3</span>-->
							<!--</label>-->
						<!--</li>-->
					<!--</ul>-->
				<!--</div>-->
<!--<textarea class="editor-panel active" id="text_5">function HelloWorld() {-->
  <!--console.log('Hello world11');-->
<!--}</textarea>-->
                  <!--<textarea class="editor-panel" id="text_6">function HelloWorld() {-->
  <!--console.log('Hello world12');-->
<!--}</textarea>-->
<!--<textarea class="editor-panel" id="text_7">function HelloWorld() {-->
  <!--console.log('Hello world13');-->
<!--}</textarea>-->
				<!--<a class="btn btn_round" href="#">-->
					<!--<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}" />-->
				<!--</a>-->
			<!--</div>-->
		<!--</div>-->

		<!--<div class="plagin-panel__panel-item">-->
			<!--<div class="plagin-panel__text-box text">-->
				<!--Сервер приложений выполняется в виртуальной Java машине (JVM),-->
				<!--что позволяет подключить к нему любую из многочисленных существующих Java-библиотек.-->
				<!--Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и-->
				<!--использовать, как если бы оно было встроенным или реализованным на языке платформы.-->
				<!--Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.-->
			<!--</div>-->
			<!--<textarea class="plagin-panel__second-box active" data-id="text_5">Hello world</textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_6">Hello world2</textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_7">Hello world3</textarea>-->
		<!--</div>-->
	<!--</div>-->
<!--</div>-->
