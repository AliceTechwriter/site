title = "Попробовать online"
url = "/try"
layout = "main"
description = "Попробовать online"
meta_title = "Попробовать online"
meta_description = "Попробовать online"
is_hidden = 0

[viewBag]
localeUrl[en] = "/poprobovat-online"
==
<?php
function onStart()
{
    $this->addJs('assets/js/codemirror.js');
	$this->addJs('assets/js/fusion.js');
    $this->addJs('assets/js/javascript.js');
    $this->addJs('https://cdn.polyfill.io/v2/polyfill.min.js');
}
?>
==
<script>

	var start_server = false,
		serverStartReturn,
		lastServerReturn,
		countServerLog = -1,
		startTime,
		prevExampleServerResult;

	window.onbeforeunload = function() {
		if (window.start_server) {
			pullServerRequest('', 'stop');
			return "Данные не сохранены. Точно перейти?";
		}
	};

	function isActiveTab() {
		// if (window.start_server) {
		// 	window.onbeforeunload = function() {
		// 		pullServerRequest('', 'stop');
		// 		return "Данные не сохранены. Точно перейти?";
		// 	};
		// }
		if (
			document.hidden &&
			window.start_server
		) {
			console.log('func isActiveTab');
			pullServerRequest('', 'stop');
		}
	}

	var timerIdIsActiveTab = setInterval(isActiveTab, 1000);

	var timerIdGetLogServer;

	function pullServerRequestDBMSMode(_this) {
		var data = _this.parentNode.querySelector('.editor-panel.active').value;

		for (var i = 0; i < _this.parentNode.getElementsByClassName('listfilter__input').length; i++) {
			if (_this.parentNode.getElementsByClassName('listfilter__input')[i].matches('input[checked="checked"]')) {
				var data_id = _this.parentNode.getElementsByClassName('listfilter__input')[i].id;
			}
		}


		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", "http://demo.lsfusion.org/erp/eval");
		xhr.setRequestHeader("Content-Type", "text/plain");

		xhr.send(data);

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				document.querySelector('textarea[data-id="'+ data_id +'"]').value = '';
				document.querySelector('textarea[data-id="'+ data_id +'"]').value = this.responseText;
			}
		});

	}

	function startServer(_data) {
		console.log('func startServer');
		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", "https://tryonline.lsfusion.org/exec?action=Main.startServer");
		xhr.setRequestHeader("Content-Type", "text/json");

		xhr.send(_data);

		xhr.addEventListener("readystatechange", function () {
			if (this.readyState === 4) {
				return this.responseText;
			}
		});
	}

	function stopServer(_data, _id) {
		console.log('func stopServer');
		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", "https://tryonline.lsfusion.org/exec?action=Main.stopServer");
		xhr.setRequestHeader("Content-Type", "text/json");

		var data = _data + window.serverStartReturn;
		xhr.send(data);

		xhr.addEventListener("readystatechange", function () {
			if (
				this.readyState === 4 &&
				_id
			) {
				document.querySelector('textarea[data-id="'+ _id +'"]').value = '';
				document.querySelector('textarea[data-id="'+ _id +'"]').value = this.responseText;
			}
		});
	}

	function restartServer(_data, _id) {
		console.log('func restartServer');
		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", "https://tryonline.lsfusion.org/exec?action=Main.restartServer");
		xhr.setRequestHeader("Content-Type", "text/json");

		var data = _data + window.serverStartReturn;
		xhr.send(data);

		xhr.addEventListener("readystatechange", function () {
			if (
				this.readyState === 4 &&
				_id
			) {
				document.querySelector('textarea[data-id="'+ _id +'"]').value = '';
			}
		});
	}

	function getLogServer(_data, _id) {
		if (
			window.countServerLog > 0 &&
			document.hidden !== true &&
			window.start_server !== false
		) {
			console.log('func getLogServer');

			var xhr = new XMLHttpRequest();
			xhr.withCredentials = true;

			xhr.open("POST", "https://tryonline.lsfusion.org/exec?action=Main.getServerLog");
			xhr.setRequestHeader("Content-Type", "text/json");

			var data = _data + window.serverStartReturn + window.lastServerReturn;
			xhr.send(data);

			xhr.addEventListener("readystatechange", function () {
				if (this.readyState === 4) {
					if (
						window.countServerLog == 1 &&
						_id
					) {
						var oldTextareaValue = document.querySelector('textarea[data-id="'+ _id +'"]').value;
						document.querySelector('textarea[data-id="'+ _id +'"]').value = oldTextareaValue + this.responseText;
					}
					window.lastServerReturn = '';
					window.lastServerReturn = this.responseText;
					window.countServerLog = 0;
				}
			});
		}
	}

	function getExampleServer(_data, _id, _date) {
		console.log('func getExampleServer');

		window.prevExampleServerResult = '';
		window.startTime = _date;

		var xhr = new XMLHttpRequest();
		xhr.withCredentials = true;

		xhr.open("POST", "https://tryonline.lsfusion.org/exec?action=Main.getExamples");
		xhr.setRequestHeader("Content-Type", "text/json");

		var data = '{mode: 3}';
		xhr.send(data);

		xhr.addEventListener("readystatechange", function () {
			if (
				this.readyState === 4 &&
				_id
			) {
				document.querySelector('textarea[data-id="'+ _id +'"]').value = '';
				document.querySelector('textarea[data-id="'+ _id +'"]').value = this.responseText;

				window.prevExampleServerResult = this.responseText;
			}
		});
	}

	function pullServerRequest(_this, _action) {
		console.log('func pullServerRequest');

		if (!_action) {
			for (var i = 0; i < _this.parentNode.getElementsByClassName('listfilter__input').length; i++) {
				if (_this.parentNode.getElementsByClassName('listfilter__input')[i].matches('input[checked="checked"]')) {
					var action = _this.parentNode.getElementsByClassName('listfilter__input')[i].value;
					var id = _this.parentNode.getElementsByClassName('listfilter__input')[i].id;
				}
			}
			var data = _this.parentNode.querySelector('.editor-panel.active').value;
		} else {
			var action = _action;
			var data = '';
			var id = '';
		}

		switch (action) {
			case 'start':
				window.start_server = true;
				window.serverStartReturn = startServer(data);
				window.timerIdIsActiveTab = setInterval(isActiveTab, 1000);
				break;
			case 'stop':
				if (window.start_server !== false) {
					restartServer(data, id);
				} else {
					window.serverStartReturn = startServer(data);
				}
				stopServer(data);
				clearInterval(window.timerIdIsActiveTab);
				clearInterval(window.timerIdGetLogServer);
				window.start_server = false;
				window.countServerLog = -1;
				break;
			case 'restart':
				if (window.start_server !== true) {
					window.serverStartReturn = startServer(data);
					window.start_server = true;
				}
				restartServer(data, id);
				window.timerIdIsActiveTab = setInterval(isActiveTab, 1000);
				break;
			case 'getLog':
				if (document.hidden !== true) {
					if (window.start_server !== true) {
						window.serverStartReturn = startServer(data);
						window.start_server = true;
					}
					window.countServerLog = 1;
					window.timerIdGetLogServer = setInterval(getLogServer, 1500, data, id);
					window.timerIdIsActiveTab = setInterval(isActiveTab, 1000);
				}
				break;
			case 'getExample':
				var date = new Date();

				if (!window.startTime) {
					window.startTime = date.getTime();
				}

				if (
					(date.getTime() - window.startTime) > 299999 ||
					(date.getTime() - window.startTime) === 0
				) {
					if (window.start_server !== true) {
						window.serverStartReturn = startServer(data);
						window.start_server = true;
					}
					restartServer(data, id);
					getExampleServer(data,id, date.getTime());
				} else if (window.prevExampleServerResult !== '') {
					document.querySelector('textarea[data-id="'+ id +'"]').value = '';
					document.querySelector('textarea[data-id="'+ id +'"]').value = window.prevExampleServerResult;
				}
				break;
		}

		console.log('start_server = ' + window.start_server);
		console.log('action = ' + action);


		// xxx
		// var data = "run() {EXPORT FROM name(DepartmentStore s);}";
		// var xhr = new XMLHttpRequest();
		// xhr.withCredentials = true;
		//
		// xhr.open("POST", "http://demo.lsfusion.org/erp/eval");
		// xhr.setRequestHeader("Content-Type", "text/plain");
		//
		// xhr.send(data);
		//
		// xhr.addEventListener("readystatechange", function () {
		// 	console.log(this);
		// });




		// var data = _this.parentNode.querySelector('textarea.active');
		//
		// var xhr = new XMLHttpRequest();
		// xhr.withCredentials = true;
		//
		// xhr.addEventListener("readystatechange", function () {
		// 	document.querySelector('textarea[data-id="text_1"]').text = this.responseText;
		// });
		//
		// xhr.open("GET", "http://demo.lsfusion.org/erp/eval");
		// xhr.setRequestHeader("cache-control", "no-cache");
		// xhr.setRequestHeader("Postman-Token", "21abf46f-99ea-44c5-ac70-1e800c1c6c84");
		//
		// xhr.send(data);
	}
</script>

<div class="show-devices">
	<p class="device-text">Доступно только в десктопной версии</p>
</div>
<div class="mode-panel hide-devices">
	<ul class="mode-panel__mode-list">
		<li class="mode-panel__mode-li">
			<a class="link mode-panel__mode-item mode-panel__mode-item_active" href="#tab_1">Mode A</a>
		</li>
		<li class="mode-panel__mode-li">
			<a class="link mode-panel__mode-item" href="#tab_2">Mode B</a>
		</li>
	</ul>
</div>
<div class="mode-content hide-devices active" id="tab_1">
	<div class="plagin-panel hide-devices">
		<div class="plagin-panel__panel-item plagin-panel__panel-item_first-box">
			<div class="plagin-panel__plagin-box">
				<div class="listfilter-panel">
					<div class="listfilter-panel__current">
						<div class="caption">Export from DepartmentStore</div>
						<div class="link-off">
							<img alt="off" src="{{ 'assets/images/arrow-white.svg'|theme }}">
						</div>
					</div>

					<ul class="listfilter-panel__list">
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="text_1"
								data-value="run() {EXPORT FROM name(DepartmentStore s);}"
							>
								<input class="listfilter__input" id="text_1" type="radio" name="text_1" value="text_1" checked="checked"/>
								<span class="listfilter__caption caption">Export from DepartmentStore</span>
							</label>
						</li>
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="text_2"
								data-value="function HelloWorld() { console.log(&quot;Hello world12&quot;); }"
							>
								<input class="listfilter__input" id="text_2" type="radio" value="text_2" name="text_1"/>
								<span class="listfilter__caption caption">Text 2</span>
							</label>
						</li>
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="text_3"
								data-value="function HelloWorld() { console.log(&quot;Hello world13&quot;); }"
							>
								<input class="listfilter__input" id="text_3" type="radio" value="text_3" name="text_1"/>
								<span class="listfilter__caption caption">Text 3</span>
							</label>
						</li>
					</ul>

				</div>
				<textarea class="editor-panel active" id="text_1">run() {EXPORT FROM name(DepartmentStore s);}</textarea>
				<!--<textarea class="editor-panel active" id="text_1">run() {EXPORT FROM name(DepartmentStore s);}-->
				<!--</textarea>-->
				<!--<textarea class="editor-panel" id="text_2">function HelloWorld() {-->
	<!--console.log('Hello world12');-->
<!--}-->
				<!--</textarea>-->
				<!--<textarea class="editor-panel" id="text_3">function HelloWorld() {-->
	<!--console.log('Hello world13');-->
<!--}-->
				<!--</textarea>-->
				<a class="btn btn_round" href="javascript:void(0);" onclick="pullServerRequestDBMSMode(this);">
					<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}">
				</a>
			</div>
		</div>
		<div class="plagin-panel__panel-item">
			<div class="plagin-panel__text-box text">
				Сервер приложений выполняется в виртуальной Java машине (JVM), что позволяет подключить к нему любую из многочисленных существующих Java-библиотек. Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и использовать, как если бы оно было встроенным или реализованным на языке платформы. Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.
			</div>
			<textarea class="plagin-panel__second-box active" data-id="text_1">Hello world</textarea>
			<textarea class="plagin-panel__second-box" data-id="text_2">Hello world2</textarea>
			<textarea class="plagin-panel__second-box" data-id="text_3">Hello world3</textarea>
		</div>
	</div>
</div>
<div class="mode-content hide-devices" id="tab_2">
	<div class="plagin-panel hide-devices">
		<div class="plagin-panel__panel-item plagin-panel__panel-item_first-box">
			<div class="plagin-panel__plagin-box">
				<div class="listfilter-panel">
					<div class="listfilter-panel__current">
						<div class="caption">Стартовать сервер</div>
						<div class="link-off">
							<img alt="off" src="{{ 'assets/images/arrow-white.svg'|theme }}">
						</div>
					</div>

					<ul class="listfilter-panel__list">
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="input_4"
								data-value="{ code = &quot;MODULE Main; FORM HelloWorld; &quot; }"
							>
								<input class="listfilter__input" id="input_4" type="radio" value="start" name="text_2" checked="checked"/>
								<span class="listfilter__caption caption">Стартовать сервер</span>
							</label>
						</li>
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="input_5"
								data-value="function HelloWorld() { console.log(&quot;Hello world14&quot;); }"
							>
								<input class="listfilter__input" id="input_5" type="radio" value="restart" name="text_2"/>
								<span class="listfilter__caption caption">Перестартовать сервер</span>
							</label>
						</li>
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="input_6"
								data-value="function HelloWorld() { console.log(&quot;Hello world15&quot;); }"
							>
								<input class="listfilter__input" id="input_6" type="radio" value="stop" name="text_2"/>
								<span class="listfilter__caption caption">Остановить сервер</span>
							</label>
						</li>
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="input_7"
								data-value="function HelloWorld() { console.log(&quot;Hello world16&quot;); }"
							>
								<input class="listfilter__input" id="input_7" type="radio" value="getLog" name="text_2"/>
								<span class="listfilter__caption caption">Получить лог с сервера</span>
							</label>
						</li>
						<li class="listfilter-panel__item">
							<label
								class="listfilter"
								for="input_8"
								data-value="function HelloWorld() { console.log(&quot;Hello world17&quot;); }"
							>
								<input class="listfilter__input" id="input_8" type="radio" value="getExample" name="text_2"/>
								<span class="listfilter__caption caption">Получить примеры</span>
							</label>
						</li>
					</ul>

				</div>
				<textarea class="editor-panel active" id="input_4">{ code = "MODULE Main; FORM HelloWorld; " }</textarea>
				<!--<textarea class="editor-panel" id="input_5">function HelloWorld() {-->
	<!--console.log('Hello world12');-->
<!--}-->
				<!--</textarea>-->
				<!--<textarea class="editor-panel" id="input_6">function HelloWorld() {-->
	<!--console.log('Hello world13');-->
<!--}-->
				<!--</textarea>-->
				<!--<textarea class="editor-panel" id="input_7">function HelloWorld() {-->
	<!--console.log('Hello world12');-->
<!--}-->
				<!--</textarea>-->
				<!--<textarea class="editor-panel" id="input_8">function HelloWorld() {-->
	<!--console.log('Hello world13');-->
<!--}-->
				<!--</textarea>-->
				<a class="btn btn_round" href="javascript:void(0);" onclick="pullServerRequest(this);">
					<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}">
				</a>
			</div>
		</div>
		<div class="plagin-panel__panel-item">
			<div class="plagin-panel__text-box text">
				Сервер приложений выполняется в виртуальной Java машине (JVM), что позволяет подключить к нему любую из многочисленных существующих Java-библиотек. Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и использовать, как если бы оно было встроенным или реализованным на языке платформы. Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.
			</div>
			<textarea class="plagin-panel__second-box active" data-id="input_4">Hello world</textarea>
			<textarea class="plagin-panel__second-box" data-id="input_5">Hello world2</textarea>
			<textarea class="plagin-panel__second-box" data-id="input_6">Hello world3</textarea>
			<textarea class="plagin-panel__second-box" data-id="input_7">Hello world2</textarea>
			<textarea class="plagin-panel__second-box" data-id="input_8">Hello world3</textarea>
		</div>
	</div>
</div>


<!--<div class="show-devices">-->
	<!--<p class="device-text">Доступно только в десктопной версии</p>-->
<!--</div>-->
<!--<div class="mode-panel hide-devices">-->
	<!--<ul class="mode-panel__mode-list">-->
		<!--<li class="mode-panel__mode-li">-->
			<!--<a class="link mode-panel__mode-item mode-panel__mode-item_active" href="#tab_1">Mode A</a>-->
		<!--</li>-->
		<!--<li class="mode-panel__mode-li">-->
			<!--<a class="link mode-panel__mode-item" href="#tab_2">Mode B</a>-->
		<!--</li>-->
	<!--</ul>-->
<!--</div>-->

<!--<div class="mode-content hide-devices active" id="tab_1">-->
	<!--<div class="plagin-panel hide-devices">-->
		<!--<div class="plagin-panel__panel-item plagin-panel__panel-item_first-box">-->
			<!--<div class="plagin-panel__plagin-box">-->
				<!--<div class="listfilter-panel">-->
					<!--<div class="listfilter-panel__current">-->
						<!--<div class="caption">EXPORT FROM name</div>-->
						<!--<div class="link-off">-->
							<!--<img alt="off" src="{{ 'assets/images/arrow-white.svg'|theme }}">-->
						<!--</div>-->
					<!--</div>-->
					<!--<ul class="listfilter-panel__list">-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_1">-->
								<!--<input class="listfilter__input" id="text_1" type="radio" name="text_1" checked="checked"/>-->
								<!--<span class="listfilter__caption caption">EXPORT FROM name</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_2">-->
								<!--<input class="listfilter__input" id="text_2" type="radio" name="text_1"/>-->
								<!--<span class="listfilter__caption caption">Text 2</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_3">-->
								<!--<input class="listfilter__input" id="text_3" type="radio" name="text_1"/>-->
								<!--<span class="listfilter__caption caption">Text 3</span>-->
							<!--</label>-->
						<!--</li>-->
					<!--</ul>-->
				<!--</div>-->
<!--<textarea class="editor-panel active" id="text_1">run() {-->
	<!--EXPORT FROM name(DepartmentStore s);-->
<!--}</textarea>-->
                  <!--<textarea class="editor-panel" id="text_2">function HelloWorld() {-->
  <!--console.log('Hello world12');-->
<!--}</textarea>-->
<!--<textarea class="editor-panel" id="text_3">function HelloWorld() {-->
  <!--console.log('Hello world13');-->
<!--}</textarea>-->
				<!--<a class="btn btn_round" href="#" onclick="pullServerRequest(this);">-->
					<!--<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}" />-->
				<!--</a>-->
			<!--</div>-->
		<!--</div>-->

		<!--<div class="plagin-panel__panel-item">-->
			<!--<div class="plagin-panel__text-box text">-->
				<!--Сервер приложений выполняется в виртуальной Java машине (JVM),-->
				<!--что позволяет подключить к нему любую из многочисленных существующих Java-библиотек.-->
				<!--Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и-->
				<!--использовать, как если бы оно было встроенным или реализованным на языке платформы.-->
				<!--Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.-->
			<!--</div>-->
			<!--<textarea class="plagin-panel__second-box active" data-id="text_1"></textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_2"></textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_3"></textarea>-->
		<!--</div>-->
	<!--</div>-->
<!--</div>-->

<!--<div class="mode-content hide-devices" id="tab_2">-->
	<!--<div class="plagin-panel hide-devices">-->
		<!--<div class="plagin-panel__panel-item plagin-panel__panel-item_first-box">-->
			<!--<div class="plagin-panel__plagin-box">-->
				<!--<div class="listfilter-panel">-->
					<!--<div class="listfilter-panel__current">-->
						<!--<div class="caption">Hello world</div>-->
						<!--<div class="link-off">-->
							<!--<img alt="off" src="{{ 'assets/images/arrow-white.svg'|theme }}">-->
						<!--</div>-->
					<!--</div>-->
					<!--<ul class="listfilter-panel__list">-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_5">-->
								<!--<input class="listfilter__input" id="text_5" type="radio" name="text_5" checked="checked"/>-->
								<!--<span class="listfilter__caption caption">Hello world</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_6">-->
								<!--<input class="listfilter__input" id="text_6" type="radio" name="text_6"/>-->
								<!--<span class="listfilter__caption caption">Text 2</span>-->
							<!--</label>-->
						<!--</li>-->
						<!--<li class="listfilter-panel__item">-->
							<!--<label class="listfilter" for="text_7">-->
								<!--<input class="listfilter__input" id="text_7" type="radio" name="text_7"/>-->
								<!--<span class="listfilter__caption caption">Text 3</span>-->
							<!--</label>-->
						<!--</li>-->
					<!--</ul>-->
				<!--</div>-->
<!--<textarea class="editor-panel active" id="text_5">function HelloWorld() {-->
  <!--console.log('Hello world11');-->
<!--}</textarea>-->
                  <!--<textarea class="editor-panel" id="text_6">function HelloWorld() {-->
  <!--console.log('Hello world12');-->
<!--}</textarea>-->
<!--<textarea class="editor-panel" id="text_7">function HelloWorld() {-->
  <!--console.log('Hello world13');-->
<!--}</textarea>-->
				<!--<a class="btn btn_round" href="#">-->
					<!--<img alt="arrow" src="{{ 'assets/images/arrow.svg'|theme }}" />-->
				<!--</a>-->
			<!--</div>-->
		<!--</div>-->

		<!--<div class="plagin-panel__panel-item">-->
			<!--<div class="plagin-panel__text-box text">-->
				<!--Сервер приложений выполняется в виртуальной Java машине (JVM),-->
				<!--что позволяет подключить к нему любую из многочисленных существующих Java-библиотек.-->
				<!--Для этого достаточно создать свое действие на Java, зарегистрировать его в платформе и-->
				<!--использовать, как если бы оно было встроенным или реализованным на языке платформы.-->
				<!--Аналогичным образом можно бесшовно подключать пользовательские SQL-функции используемого сервера БД.-->
			<!--</div>-->
			<!--<textarea class="plagin-panel__second-box active" data-id="text_5">Hello world</textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_6">Hello world2</textarea>-->
			<!--<textarea class="plagin-panel__second-box" data-id="text_7">Hello world3</textarea>-->
		<!--</div>-->
	<!--</div>-->
<!--</div>-->
